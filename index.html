<script>
    let currentGuess = ""; // Mantiene traccia del tentativo attuale

    // Gestione del tasto backspace e invio
    document.addEventListener("keydown", (e) => {
        if (e.key === "Backspace") {
            handleBackspace();
        } else if (e.key === "Enter") {
            handleEnter();
        } else if (/^[a-z]$/i.test(e.key)) {
            handleKeyPress(e.key.toLowerCase());
        }
    });

    function handleBackspace() {
        if (currentGuess.length > 0) {
            currentGuess = currentGuess.slice(0, -1);
            updateWordContainer();
        }
    }

    function handleEnter() {
        if (currentGuess.length === currentWord.length) {
            checkWord(currentGuess);
        } else {
            alert("Completa la parola prima di inviarla!");
        }
    }

    function handleKeyPress(letter) {
        if (currentGuess.length < currentWord.length) {
            currentGuess += letter;
            updateWordContainer();
        }
    }

    function updateWordContainer() {
        const container = document.getElementById("word-container");
        [...container.children].forEach((div, index) => {
            div.innerText = currentGuess[index] ? currentGuess[index].toUpperCase() : "";
        });
    }

    function checkWord(guess) {
        if (guess === currentWord) {
            endGame(true);
        } else {
            attempts++;
            if (attempts >= maxAttempts) {
                endGame(false);
            } else {
                provideFeedback(guess);
                currentGuess = ""; // Resetta il tentativo
                updateWordContainer(); // Pulisce la UI
            }
        }
    }

    function provideFeedback(guess) {
        const feedback = [];
        for (let i = 0; i < currentWord.length; i++) {
            if (guess[i] === currentWord[i]) {
                feedback.push("correct");
            } else if (currentWord.includes(guess[i])) {
                feedback.push("present");
            } else {
                feedback.push("absent");
            }
        }
        updateKeyboardFeedback(feedback, guess);
    }

    function updateKeyboardFeedback(feedback, guess) {
        const keys = document.querySelectorAll(".key");
        for (let i = 0; i < guess.length; i++) {
            const key = [...keys].find(k => k.innerText === guess[i].toUpperCase());
            if (feedback[i] === "correct") {
                key.classList.add("correct");
            } else if (feedback[i] === "present") {
                key.classList.add("present");
            } else {
                key.classList.add("wrong");
            }
        }
    }
</script>